<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>rSkybox</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="//ajax.aspnetcdn.com/ajax/jquery.mobile/1.0/jquery.mobile-1.0.min.css" />
    <link rel="stylesheet" href="/css/styles.css">
    <script src="//ajax.aspnetcdn.com/ajax/jQuery/jquery-1.6.4.min.js"></script>
    <script>
      window.jQuery || document.write('<script src="/js/libs/jquery-1.6.4.min.js"><\/script>')
    </script>
    <script src="//ajax.aspnetcdn.com/ajax/jquery.mobile/1.0/jquery.mobile-1.0.min.js"></script>
    <script>
      window.jQuery.mobile || document.write('<script src="/js/libs/jquery.mobile-1.0.min.js"><\/script>')
    </script>
    <script src="/js/rmodule.js"></script>
  </head>
  <body>
    <script src="/js/signup.js"></script>
<script>
'use strict';

var RMODULE = (function (my) {

  var
    confirmPage,
    requestConfirmCode;


  confirmPage = function (page, url) {
    console.log('in confirmPage ');
    console.log(url);
  };

  requestConfirmCode = function () {
    var json, signup;

    signup = {
      emailAddress: $('#emailAddress').val(),
      phoneNumber: $('#phoneNumber').val(),
      mobileCarrierId: $('#mobileCarrierId').val()
    }

    if (!my.isValidSignup(signup)) {
      alert('Please enter your email address, or your phone number and mobile carrier.');
      return false;
    }

    json = JSON.stringify(signup);
    my.postJson(my.getRestPrefix() + '\/users\/requestConfirmation', json, function (confirmData) {
      // TODO replace 'signup' in the following call with 'confirmData'
      $.mobile.changePage('#confirm' + my.getQueryString(signup));
    });
    return false;
  }


  my.init = function () {
    // If there is a current user, redirect right away.
    $('#index').live('pagebeforecreate', function () {
      my.getCurrentUser(function () {
        if (location.hostname === "www.rskybox.com") {
          my.redirect('https://rskybox-stretchcom.appspot.com/html5');
        } else {
          my.redirect('/html5');
        }
      });
    });

    $('#index').live('pageshow', function () {
      my.jsonPopulate(my.getMobileCarriersUrl(), $('#mobileCarrierId'), function (select, carriers) {
        select.html(my.getOptionsForSelect(carriers.mobileCarriers, 'Mobile Carriers')).selectmenu('refresh');
      });
    });

    $('#index').live('pagecreate', function () {
      $(this).find('form').submit(requestConfirmCode);
    });

    my.dynamicPages([{
      page: '#confirm',
      function: confirmPage
    }]);
  };

  return my;
}(RMODULE || {}));

RMODULE.init();
</script>

<div data-role="page" id="index" data-title="rSkybox Signup">
  <div data-role="header">
    <h1>rSkybox Signup</h1>
    <a href="#login" class="ui-btn-right">Log In</a>
  </div>
  <div data-role="content">
    <div style="text-align: center;">
      <strong>Watch your application from the best seat in the house.</strong>
    </div>
    <form>
      <h1>Sign Up Using</h1>
      <label for="emailAddress" class="ui-hidden-accessible">Email Address:</label>
      <input type="email" name="emailAddress" id="emailAddress" placeholder="Email Address">
      <strong>or</strong>
      <label for="phoneNumber" class="ui-hidden-accessible">Phone Number:</label>
      <input type="tel" name="phoneNumber" id="phoneNumber" placeholder="Phone Number">
      <label for="mobileCarrierId" class="ui-hidden-accessible">Mobile Carrier:</label>
      <select name="mobileCarrierId" id="mobileCarrierId"></select>

      <input type="submit" value="Request Confirmation Code">
    </form>
  </div>
</div>

<div data-role="page" id="confirm" data-title="Confirm Signup">
  <div data-role="header">
    <h1>Confirm Signup</h1>
  </div>
  <div data-role="content">
    <form>
    </form>
  </div>
</div>

  </body>
</html>
